# Echarts:Calendar，日期相关数据的可视化

ECharts图表库，提供直观，生动，可交互，可高度个性化定制的数据可视化图表。Echarts提供丰富的图表类型、多个坐标系的支持、移动端的优化、深度的交互式数据探索、大数据量的展现、多维数据的支持以及丰富的视觉编码手段、支持动态数据以及绚丽的特效等。Echarts主页：http://echarts.baidu.com/

近期在整理一下数据，其中一些数据带有日期属性，使用了Echarts的Calendar做可视化，最终效果如下图。

![最终效果图](https://github.com/shuzhizhang/wechat/blob/master/calendar/img/1.jpg)

该图把2018年1月到3月每天的调查发生数展示在日历上，点的直径大小代表了调查发生数的数量，发生数Top5添加了动态效果。可以直观的看出，该调查数据每天的发生数分布不平均，主要集中在周一到周五时间段中。   
鼠标滑过图例，相应的数据点会有强调效果；点击图例，可以显示或者隐藏数据；鼠标数据点，会出现详细的数据说明。

### 如何使用本文

Echarts图表需要使用HTML实现，点击文尾的“阅读原文”跳转至github仓库，仓库里中有数据文档data.xlsx和完整HTML内容calendar.html。建议大家在pc端参考该仓库中的资料进行操作,把完整HTML内容使用记事本或者文本编辑器保存为calendar.html（utf-8格式），结合下边的文档内容解释，自行尝试修改调整，同时使用浏览器打开该HTML文档查看修改调整的效果。

### 文档内容解释
calendar.html文档共计245行，文尾的“阅读原文”跳转到github，查看可复制的文档。

下面以文档每行的行号为索引，逐句解释文档的内容。

- 第1行，指示浏览器使用HTML 5版本进行解释页面。
- 第2行和第245行，告知浏览器该文档是一个 HTML 文档，“html”与“ /html ”标签限定了文档的开始点和结束点，在它们之间是文档的头部和主体。文档的头部由 “head” 标签定义，而主体由 “body” 标签定义。html标签使用解释详见参考手册（www.w3school.com.cn/tags/）。
- 第3行和第7行，“head”与 “/head” 标签限定了文档头部的开始点和结束点，文档头部描述了文档的各种属性和信息，包括文档的标题、在 Web 中的位置以及和其他文档的关系等。绝大多数文档头部包含的数据都不会真正作为内容显示给读者。
- 第8行和第244行，“body”与 “/body”标签限定了文档主体的开始点和结束点，body 元素包含文档的所有内容（比如文本、超链接、图像、表格和列表等等）。这里的文档内容只有一个放置Echarts的容器，见第9行。
- 第4行，“meta”元素可提供有关页面的元信息，charset说明了文档编码为utf-8。
- 第5行，“title” 元素定义文档的标题。浏览器通常把标题放置在浏览器窗口的标题栏或状态栏上。
- 第6行，script标签用于定义客户端脚本，script 元素既可以包含脚本语句，也可以通过src属性指向外部脚本文件。也就是网页三要素中的JS。这里使用src属性引入Echarts的在线文档，也就是Echarts图表库。
- 第9行，”div”可定义文档中的分区或节，”div” 标签可以把文档分割为独立的、不同的部分。这里使用id属性来命名该div元素，作为放置Echarts图表的容器；style属性用于为 HTML 文档定义样式信息，也就是网页三要素中的CSS，style属性的值用英文分号分开，用于说明元素的样式，这里的样式是宽度500像素、高度300像素和居中对齐。可以手动修改CSS以观察不同的样式效果。
- 第11行和第243行，script标签用于定义客户端脚本，这里是该文档的核心，包括创建图表、配置图表都在这里实现。
- 第13行，第149行到第242行，使用一个函数function，形成图表所需的特定格式的数据，数据为1月至3月每天的日期和每天的调查发生数，数据是一个二维数组，第一维度长度为90(共计90天的数据)，第二维度长度为2(日期和发生数)。添加数据的代码使用excel公式生成。
- 第15行到第144行，使用“var”关键字定义一个图表配置变量，用于第147行进行配置图表。图表选项极其丰富，详请参考Echarts文档中的配置项手册（echarts.baidu.com/option.html）。
- 第16行，设定图表的背景颜色，颜色值为“#404a59”。
- 第17行到第24行，设定图表的标题，标题内容为“调查时间分布”，标题字体的颜色为“#fff”(白色)，标题位置是左右居中，离顶部的距离为图表高度的3%。
- 第25行到第27行，设定图表的提示内容。
- 第28行到第235行，设定图表的图例，图例为“调查数量”和“Top 5”，图例字体颜色为白色，位置是左右居中，离顶部的距离为图表高度的92%。
- 第36行到143行，calendar内容设定。
 - 第37行到第40行，日历框距图表顶部20%；左边、右边和底部均为10%，
 - 第41行，日历的日期范围为1月到3月。
 - 第42行到第49行，日历的分割线格式，显示日历的分割线，白色线条，线宽为4像素。
 - 第64行到142行，数据处理，70行、86行、103行、127行设定数据点的相对大小，99行到101行、123行到125行抽取Top5的数据，其他参数的意义详见Echarts文档中的配置项手册
- 第146行，使用“var”关键字定义一个myChart变量，变量值为创建的Echarts图表，创建图表的同时，和名为container的元素联系起来，也就是把图表放置在第9行的图表容器中。
- 第147行，把前面定义的配置项变量option应用于图表变量myChart。

文档解释结束，可以根据相关的文档参考和自己的设想，自行修改，比如修改一下数据集数值，然后在浏览器中查看图表效果。

### 其他
在浏览器中打开文档，没有得到预期效果的可能原因：
- 手动输入文档内容时：注意拼写是否正确，特别是括号，每行结尾的分号等，推荐使用有高亮提示的文本编辑器，比如EditPlus等；中英文输入法是否正确，建议先复制调试，熟练后再手动输入。
- 文档修改后保存，即Ctr+S后，浏览器才能读取修改后的内容。
- 乱码问题，文档要保存为utf-8编码，文档内也要说明编码为utf-8，浏览器也选择utf-8编码进行浏览，也就是“三码统一”。
- 浏览器兼容问题，选用主流的现代浏览器，本文档使用chrome可以正常显示。
- 你还需要网络，取得在线的Echarts库文档。

本文到此结束。
